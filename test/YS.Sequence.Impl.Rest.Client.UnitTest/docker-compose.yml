version: '3.3'

services:
  db:
    image: mysql:5.5
    environment:
      MYSQL_ROOT_PASSWORD: my-secret-pw
  init_context:
    depends_on: 
      - db
    build: 
      context: ../
      dockerfile: YS.Sequence.App/Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      Stage: install
      ConnectionStrings__SequenceContext: Server=db;Port=3306;Database=SequenceContext; User=root;Password=my-secret-pw;
    entrypoint: sh -c "sleep 80 && dotnet YS.Sequence.App.dll"
  api:
    depends_on: 
      - db
    build: 
      context: ../
      dockerfile: YS.Sequence.App/Dockerfile
    ports:
    - "${API_PORT:-8080}:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ConnectionStrings__SequenceContext: Server=db;Port=3306;Database=SequenceContext; User=root;Password=my-secret-pw;
